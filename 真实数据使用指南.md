# 飞书审批打印插件 - 真实数据使用指南

## 🚀 重要变更

应用已完全移除模拟数据，现在**只使用真实的飞书API数据**。这意味着：

- ✅ 不再显示测试数据
- ✅ 只在飞书环境中正常工作
- ✅ 需要正确的应用配置
- ✅ 提供真实的审批记录打印功能

## 📋 使用前准备

### 1. 确保在飞书环境中运行

应用会自动检测当前环境：
- **飞书环境**：`feishu.cn`、`larksuite.com`、`fs.huidu.cn`
- **本地环境**：显示环境状态页面，引导用户配置

### 2. 配置应用凭证

在飞书开放平台获取并配置：
- **App ID**：格式如 `cli_xxxxxxxxx`
- **App Secret**：32位字符串
- **权限配置**：
  - `bitable:app` - 多维表格应用权限
  - `bitable:readonly` - 多维表格只读权限
  - `bitable:write` - 多维表格写入权限

## 🔧 本地调试步骤

### 步骤1：配置应用凭证

1. 访问 http://localhost:3002
2. 点击"应用配置"按钮
3. 在"基本配置"标签页填写：
   ```
   App ID: cli_your_app_id_here
   App Secret: your_32_character_secret_here
   重定向URL: http://localhost:3002
   ```
4. 点击"保存配置"

### 步骤2：在飞书中添加应用

1. 打开飞书多维表格
2. 点击"插件"或"应用"按钮
3. 选择"添加应用"
4. 输入您的应用信息或扫描二维码
5. 授予表格访问权限

### 步骤3：验证配置

配置完成后，应用会显示：
- ✅ 环境正常
- ✅ 显示真实的表格ID和用户信息
- ✅ 可以访问真实的审批记录数据

## 🎯 功能特性

### 真实数据访问
- **审批记录列表**：从飞书多维表格获取真实数据
- **记录详情**：显示完整的审批信息和流程
- **字段信息**：动态获取表格字段定义
- **视图支持**：支持多维表格的不同视图

### 错误处理
- **环境检测**：自动检测是否在飞书环境中
- **配置验证**：验证应用凭证的完整性
- **权限检查**：检查是否有必要的API权限
- **友好提示**：提供详细的错误信息和解决建议

## 🔍 环境状态说明

### 正常状态
```
🟢 环境正常
飞书环境检测正常，应用配置完整。
```

### 警告状态
```
🟡 不在飞书环境中
请在飞书多维表格中使用此应用，以获得完整的审批记录打印功能。
```

```
🟡 应用配置不完整
请配置应用凭证以获得完整功能。
```

### 错误状态
```
🔴 SDK初始化失败
飞书SDK加载失败，请检查应用配置是否正确。
```

## 📊 数据字段说明

应用会自动读取您的多维表格字段，常见字段包括：

### 必需字段
- `审批实例ID` - 文本类型，唯一标识
- `审批类型` - 单选类型，如"请假审批"、"报销审批"
- `申请人` - 文本类型，申请人姓名
- `审批状态` - 单选类型，如"待审批"、"已通过"、"已拒绝"

### 可选字段
- `申请部门` - 文本类型
- `申请时间` - 日期时间类型
- `审批时间` - 日期时间类型
- `审批人` - 文本类型
- `审批意见` - 文本类型

## 🛠️ 开发调试

### 本地开发
在本地开发时，应用会显示环境状态页面，提供：
- 当前环境信息
- 配置指南
- 快速配置入口

### 生产部署
在飞书环境中部署时：
1. 确保应用已发布到飞书开放平台
2. 配置正确的重定向URL
3. 设置必要的权限范围
4. 测试所有功能正常工作

## ❓ 常见问题

### Q: 为什么看不到任何数据？
A: 请确保：
1. 在飞书多维表格中使用应用
2. 应用配置已正确设置
3. 表格中有数据记录
4. 应用有表格访问权限

### Q: 配置保存后仍然提示错误？
A: 检查：
1. App ID格式是否正确（cli_xxxxxxxxx）
2. App Secret是否完整（32位字符）
3. 应用权限是否已正确配置
4. 是否在正确的飞书环境中

### Q: 如何获取表格数据？
A: 应用会自动：
1. 检测当前表格ID
2. 读取表格字段定义
3. 获取所有记录数据
4. 根据视图进行筛选和排序

## 🔄 数据同步

应用支持实时数据同步：
- **自动刷新**：页面加载时自动获取最新数据
- **手动同步**：点击"同步数据"按钮
- **事件监听**：监听表格数据变化事件

---

**重要提醒**：移除模拟数据后，应用**必须**在飞书环境中使用，并配置正确的应用凭证才能正常工作。